{% extends 'base.html.twig' %}

{% block title %}Mes Cours{% endblock %}
    
{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('styles/listCourse.css') }}">
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const courseContainer = document.querySelector('.cours');
            const paginationContainer = document.querySelector('.pagination');
            let itemsPerPage = 6;
            let currentPage = 1;
            let courses = [];

            function fetchCourses() {
                fetch('/api/my-courses')
                    .then(response => response.json())
                    .then(data => {
                        courses = data;
                        displayCourses(currentPage, itemsPerPage);
                        updatePagination();
                    })
                    .catch(error => console.error('Error fetching courses:', error));
            }

            function displayCourses(page, itemsPerPage) {
                courseContainer.innerHTML = '';
                const start = (page - 1) * itemsPerPage;
                const end = start + itemsPerPage;
                courses.slice(start, end).forEach(course => {
                    const courseElement = document.createElement('div');
                    courseElement.classList.add('case-cours');
                    courseElement.innerHTML = `
                        <a href="/course/${course.id}">
                            <div class="course-image">
                                <img src="/images/${course.image}" alt="Course Image">
                            </div>
                            <div class="course-title">
                                <p>${course.nom} (${course.code})</p>
                                <div class="course-description">
                                    <p>${course.description}</p>
                                </div>
                            </div>
                        </a>
                    `;
                    courseContainer.appendChild(courseElement);
                });
            }

            function updatePagination() {
                paginationContainer.innerHTML = '';
                const totalPages = Math.ceil(courses.length / itemsPerPage);

                const prevButton = document.createElement('button');
                prevButton.classList.add('btn-pagination');
                prevButton.innerHTML = '<ion-icon name="caret-back-outline"></ion-icon>';
                prevButton.addEventListener('click', () => {
                    if (currentPage > 1) {
                        currentPage--;
                        displayCourses(currentPage, itemsPerPage);
                    }
                });
                paginationContainer.appendChild(prevButton);

                const nextButton = document.createElement('button');
                nextButton.classList.add('btn-pagination');
                nextButton.innerHTML = '<ion-icon name="caret-forward-outline"></ion-icon>';
                nextButton.addEventListener('click', () => {
                    if (currentPage < totalPages) {
                        currentPage++;
                        displayCourses(currentPage, itemsPerPage);
                    }
                });
                paginationContainer.appendChild(nextButton);
            }

            fetchCourses();

            document.querySelectorAll('.tri-cours-5 .dropdown-item').forEach(item => {
                item.addEventListener('click', (event) => {
                    const selectedOption = event.target.textContent;
                    itemsPerPage = selectedOption.toLowerCase() === 'tous' ? courses.length : parseInt(selectedOption);
                    document.querySelector('.tri-cours-5 button').innerHTML = `Nombre de cours : ${selectedOption} <ion-icon name="caret-down-outline"></ion-icon>`;
                    currentPage = 1;
                    displayCourses(currentPage, itemsPerPage);
                    updatePagination();
                });
            });

            document.querySelectorAll('.tri-cours-4 .dropdown-item').forEach(item => {
                item.addEventListener('click', (event) => {
                    const mode = event.target.textContent.toLowerCase();
                    if (mode === 'carte') {
                        courseContainer.classList.add('carte-mode');
                        courseContainer.classList.remove('list-mode', 'description-mode');
                    } else if (mode === 'liste') {
                        courseContainer.classList.add('list-mode');
                        courseContainer.classList.remove('carte-mode', 'description-mode');
                    } else if (mode === 'résumé') {
                        courseContainer.classList.add('description-mode');
                        courseContainer.classList.remove('carte-mode', 'list-mode');
                    }
                    document.querySelector('.tri-cours-4 button').innerHTML = `${event.target.textContent} <ion-icon name="caret-down-outline"></ion-icon>`;
                });
            });

            document.querySelectorAll('.tri-cours-3 .dropdown-item').forEach(item => {
                item.addEventListener('click', (event) => {
                    const sortBy = event.target.textContent.toLowerCase();
                    if (sortBy === 'trier par nom de cours') {
                        courses.sort((a, b) => a.nom.localeCompare(b.nom));
                    } else if (sortBy === 'trier par dernier accès') {
                        courses.sort((a, b) => new Date(b.dateDernierAcces) - new Date(a.dateDernierAcces));
                    }
                    document.querySelector('.tri-cours-3 button').innerHTML = `${event.target.textContent} <ion-icon name="caret-down-outline"></ion-icon>`;
                    currentPage = 1;
                    displayCourses(currentPage, itemsPerPage);
                    updatePagination();
                });
            });
        });
    </script>
{% endblock %}

{% block body %}
<body>
<div class="content">
    <div class="container">
        <h1>Mes cours</h1>
        <div class="liste-cours">
            <h2>Vue d'ensemble des cours</h2>
            <div class="ligne-gris"></div>
            <div class="tri-course">
                <div class="liste-tri-cours">
                    <div class="tri-cours-1">
                            <button class="btn-tri-cours">Tout <ion-icon name="caret-down-outline"></ion-icon></button>
                            <ul class="dropdown">
                                <li><a href="#" class="dropdown-item">Tout</a></li>
                                <li class="dropdown-divider"></li>
                                <li><a href="#" class="dropdown-item">Favoris</a></li>
                            </ul>
                        </div>
                        <div class="tri-cours-2">
                            <input type="text" placeholder="Rechercher">
                        </div>
                        <div class="tri-cours-3">
                            <button class="btn-tri-cours">Trier par nom de cours <ion-icon name="caret-down-outline"></ion-icon></button>
                            <ul class="dropdown">
                                <li><a href="#" class="dropdown-item">Trier par nom de cours</a></li>
                                <li><a href="#" class="dropdown-item">Trier par dernier accès</a></li>  
                            </ul>
                        </div>
                        <div class="tri-cours-4">
                            <button class="btn-tri-cours">Carte <ion-icon name="caret-down-outline"></ion-icon></button>
                            <ul class="dropdown">
                                <li><a href="#" class="dropdown-item">Carte</a></li>
                                <li><a href="#" class="dropdown-item">Liste</a></li>
                                <li><a href="#" class="dropdown-item">Résumé</a></li>
                            </ul>
                        </div>
                        <div class="tri-cours-5">
                            <button class="btn-tri-cours">Nombre de cours : 6 <ion-icon name="caret-down-outline"></ion-icon></button>
                            <ul class="dropdown">
                                <li><a href="#" class="dropdown-item">6</a></li>
                                <li><a href="#" class="dropdown-item">12</a></li>
                                <li><a href="#" class="dropdown-item">18</a></li>
                                <li class="dropdown-divider"></li>
                                <li><a href="#" class="dropdown-item">Tous</a></li>
                            </ul>
                        </div>
                </div>
            </div>
            <div class="cours carte-mode">
                <!-- Les cours seront injectés ici -->
            </div>
            <div class="pagination">
                <!-- Pagination JS -->
            </div>
        </div>
    </div>
</div>


</body>
{% endblock %}
